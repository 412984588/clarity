# Incident Response Playbook

**Version**: 1.0
**Last Updated**: 2025-12-23

---

## Purpose & Scope

æœ¬æ–‡æ¡£å®šä¹‰ Solacore ç”Ÿäº§ç¯å¢ƒæ•…éšœçš„å“åº”æµç¨‹ã€ä¸¥é‡çº§åˆ«å®šä¹‰ã€é€šä¿¡è§„èŒƒå’Œå¤ç›˜æ¨¡æ¿ã€‚é€‚ç”¨äºæ‰€æœ‰å½±å“ç”¨æˆ·ä½“éªŒæˆ–ç³»ç»Ÿå¯ç”¨æ€§çš„ç”Ÿäº§äº‹ä»¶ã€‚

**èŒƒå›´**ï¼š
- ç”Ÿäº§ç¯å¢ƒæœåŠ¡ä¸­æ–­
- æ€§èƒ½ä¸¥é‡åŠ£åŒ–
- æ•°æ®å¼‚å¸¸æˆ–ä¸¢å¤±
- å®‰å…¨äº‹ä»¶
- ç¬¬ä¸‰æ–¹æœåŠ¡æ•…éšœï¼ˆStripe/RevenueCat/LLMï¼‰

**ä¸åœ¨èŒƒå›´**ï¼š
- å¼€å‘/æµ‹è¯•ç¯å¢ƒé—®é¢˜
- éç´§æ€¥çš„åŠŸèƒ½ç¼ºé™·ï¼ˆèµ°æ­£å¸¸ Bug æµç¨‹ï¼‰

---

## Severity Levels

### P0 - Criticalï¼ˆç´§æ€¥ï¼‰

| å±æ€§ | å®šä¹‰ |
|------|------|
| **å½±å“** | æ ¸å¿ƒåŠŸèƒ½å®Œå…¨ä¸å¯ç”¨ï¼Œå½±å“æ‰€æœ‰ç”¨æˆ· |
| **ç¤ºä¾‹** | API å…¨æŒ‚ã€æ•°æ®åº“ä¸å¯è®¿é—®ã€æ”¯ä»˜å®Œå…¨å¤±è´¥ã€ç”¨æˆ·æ— æ³•ç™»å½• |
| **å“åº”æ—¶é—´** | 15 åˆ†é’Ÿå†…å“åº” |
| **è§£å†³ç›®æ ‡** | 1 å°æ—¶å†…æ­¢æŸæˆ–å›æ»š |
| **å‡çº§è·¯å¾„** | ç«‹å³é€šçŸ¥æ‰€æœ‰ç›¸å…³è´Ÿè´£äºº + ç®¡ç†å±‚ |
| **é€šä¿¡é¢‘ç‡** | æ¯ 15 åˆ†é’Ÿæ›´æ–°çŠ¶æ€ |

### P1 - Highï¼ˆé«˜ï¼‰

| å±æ€§ | å®šä¹‰ |
|------|------|
| **å½±å“** | ä¸»è¦åŠŸèƒ½å—æŸï¼Œå½±å“å¤§é‡ç”¨æˆ· |
| **ç¤ºä¾‹** | Solve æµç¨‹æŸæ­¥éª¤å¤±è´¥ã€SSE æµä¸­æ–­ã€éƒ¨åˆ† API è¶…æ—¶ã€æƒ…ç»ªæ£€æµ‹å¼‚å¸¸ |
| **å“åº”æ—¶é—´** | 30 åˆ†é’Ÿå†…å“åº” |
| **è§£å†³ç›®æ ‡** | 4 å°æ—¶å†…ä¿®å¤æˆ–æä¾›ä¸´æ—¶æ–¹æ¡ˆ |
| **å‡çº§è·¯å¾„** | é€šçŸ¥ç›¸å…³æŠ€æœ¯è´Ÿè´£äºº |
| **é€šä¿¡é¢‘ç‡** | æ¯ 30 åˆ†é’Ÿæ›´æ–°çŠ¶æ€ |

### P2 - Mediumï¼ˆä¸­ï¼‰

| å±æ€§ | å®šä¹‰ |
|------|------|
| **å½±å“** | æ¬¡è¦åŠŸèƒ½å—æŸï¼Œå½±å“éƒ¨åˆ†ç”¨æˆ· |
| **ç¤ºä¾‹** | i18n æ˜¾ç¤ºå¼‚å¸¸ã€éå…³é”® API å»¶è¿Ÿã€UI æ¸²æŸ“é—®é¢˜ã€æ—¥å¿—é‡‡é›†ä¸­æ–­ |
| **å“åº”æ—¶é—´** | 2 å°æ—¶å†…å“åº” |
| **è§£å†³ç›®æ ‡** | 24 å°æ—¶å†…ä¿®å¤ |
| **å‡çº§è·¯å¾„** | é€šçŸ¥å¯¹åº”æ¨¡å—è´Ÿè´£äºº |
| **é€šä¿¡é¢‘ç‡** | æ¯ 2 å°æ—¶æ›´æ–°çŠ¶æ€ |

### Severity Matrix

```
              Low Impact    Medium Impact    High Impact    Critical Impact
Widespread    P1            P0               P0             P0
Many Users    P2            P1               P0             P0
Some Users    P2            P2               P1             P1
Few Users     P2            P2               P2             P1
```

---

## Detection & Triage

### Detection Sourcesï¼ˆä¿¡å·æ¥æºï¼‰

| æ¥æº | ç¤ºä¾‹ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Monitoring Alerts** | API é”™è¯¯ç‡ > 5%ã€å“åº”æ—¶é—´ > 2sã€æ•°æ®åº“è¿æ¥æ±  > 90% | High |
| **Health Checks** | /health è¿”å›é 200ã€/health/ready å¤±è´¥ | High |
| **User Reports** | ç”¨æˆ·æŠ•è¯‰ã€App Store å·®è¯„ã€ç¤¾äº¤åª’ä½“ | Medium |
| **Internal Discovery** | å›¢é˜Ÿæˆå‘˜å‘ç°ã€QA æµ‹è¯•ä¸­å‘ç° | Medium |
| **Third-party Alerts** | Stripe/RevenueCat/Sentry é€šçŸ¥ | High |
| **Scheduled Checks** | å®šæ—¶å·¡æ£€ã€æ¯æ—¥å†’çƒŸæµ‹è¯• | Low |

### Triage Stepsï¼ˆåˆæ­¥åˆ¤æ–­ï¼‰

1. **ç¡®è®¤é—®é¢˜çœŸå®æ€§**
   - æ˜¯å¦å¯å¤ç°ï¼Ÿ
   - å½±å“èŒƒå›´å¤šå¤§ï¼Ÿ
   - æ˜¯å¦æŒç»­å‘ç”Ÿè¿˜æ˜¯å¶å‘ï¼Ÿ

2. **åˆæ­¥åˆ†ç±»**
   - å‰ç«¯ / åç«¯ / æ•°æ®åº“ / ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Ÿ
   - ä»£ç é—®é¢˜ / é…ç½®é—®é¢˜ / åŸºç¡€è®¾æ–½é—®é¢˜ï¼Ÿ

3. **ç¡®å®šä¸¥é‡çº§åˆ«**
   - å‚ç…§ä¸Šæ–¹ Severity Matrix
   - æœ‰ç–‘é—®æ—¶ï¼Œåå‘é€‰æ‹©æ›´é«˜çº§åˆ«

4. **æŒ‡æ´¾ Incident Commander**
   - P0/P1ï¼šç”±åœ¨çº¿çš„æœ€èµ„æ·±å·¥ç¨‹å¸ˆæ‹…ä»»
   - P2ï¼šç”±å¯¹åº”æ¨¡å—è´Ÿè´£äººæ‹…ä»»

---

## Response Workflow

### Overview

```
Detection â†’ Triage â†’ Contain â†’ Recover â†’ Postmortem
    â†“         â†“         â†“          â†“          â†“
 å‘ç°é—®é¢˜   åˆ¤æ–­çº§åˆ«   æ­¢æŸ     æ¢å¤æœåŠ¡    å¤ç›˜æ€»ç»“
```

### Phase 1: Detectionï¼ˆå‘ç°ï¼‰

| æ­¥éª¤ | åŠ¨ä½œ | è´Ÿè´£äºº |
|------|------|--------|
| 1.1 | æ”¶åˆ°å‘Šè­¦æˆ–æŠ¥å‘Š | ä»»ä½•äºº |
| 1.2 | åˆæ­¥éªŒè¯é—®é¢˜ | å‘ç°è€… |
| 1.3 | åˆ›å»º Incident Ticket | å‘ç°è€… |
| 1.4 | é€šçŸ¥ On-call æˆ–ç›¸å…³è´Ÿè´£äºº | å‘ç°è€… |

### Phase 2: Triageï¼ˆåˆ†ç±»ï¼‰

| æ­¥éª¤ | åŠ¨ä½œ | è´Ÿè´£äºº |
|------|------|--------|
| 2.1 | ç¡®è®¤å½±å“èŒƒå›´å’Œä¸¥é‡çº§åˆ« | Incident Commander |
| 2.2 | ç»„å»ºå“åº”å›¢é˜Ÿ | Incident Commander |
| 2.3 | å»ºç«‹æ²Ÿé€šæ¸ é“ï¼ˆSlack/ç”µè¯ï¼‰ | Incident Commander |
| 2.4 | é¦–æ¬¡çŠ¶æ€é€šæŠ¥ | Incident Commander |

### Phase 3: Containï¼ˆæ­¢æŸï¼‰

| æ­¥éª¤ | åŠ¨ä½œ | è´Ÿè´£äºº |
|------|------|--------|
| 3.1 | å¿«é€Ÿè¯Šæ–­æ ¹å›  | æŠ€æœ¯å›¢é˜Ÿ |
| 3.2 | è¯„ä¼°æ­¢æŸæ–¹æ¡ˆï¼ˆå›æ»š / çƒ­ä¿®å¤ / é™çº§ï¼‰ | æŠ€æœ¯å›¢é˜Ÿ |
| 3.3 | æ‰§è¡Œæ­¢æŸæ–¹æ¡ˆ | Backend/DevOps Lead |
| 3.4 | éªŒè¯æ­¢æŸæ•ˆæœ | QA Lead |
| 3.5 | æ›´æ–°çŠ¶æ€é€šæŠ¥ | Incident Commander |

### Phase 4: Recoverï¼ˆæ¢å¤ï¼‰

| æ­¥éª¤ | åŠ¨ä½œ | è´Ÿè´£äºº |
|------|------|--------|
| 4.1 | å½»åº•ä¿®å¤é—®é¢˜ï¼ˆå¦‚æ­¢æŸæ–¹æ¡ˆæ˜¯ä¸´æ—¶çš„ï¼‰ | æŠ€æœ¯å›¢é˜Ÿ |
| 4.2 | éªŒè¯ä¿®å¤æ•ˆæœ | QA Lead |
| 4.3 | æ¢å¤æ­£å¸¸æœåŠ¡ | DevOps |
| 4.4 | æŒç»­ç›‘æ§ 30 åˆ†é’Ÿ | æŠ€æœ¯å›¢é˜Ÿ |
| 4.5 | å®£å¸ƒäº‹ä»¶ç»“æŸ | Incident Commander |

### Phase 5: Postmortemï¼ˆå¤ç›˜ï¼‰

| æ­¥éª¤ | åŠ¨ä½œ | è´Ÿè´£äºº |
|------|------|--------|
| 5.1 | æ”¶é›†æ—¶é—´çº¿å’Œè¯æ® | Incident Commander |
| 5.2 | ç»„ç»‡å¤ç›˜ä¼šè®®ï¼ˆ48 å°æ—¶å†…ï¼‰ | Incident Commander |
| 5.3 | æ’°å†™ Postmortem æŠ¥å‘Š | Incident Commander |
| 5.4 | åˆ¶å®šæ”¹è¿›æªæ–½å¹¶è·Ÿè¸ª | ç›¸å…³è´Ÿè´£äºº |

---

## Communication Plan

### Internal Communicationï¼ˆå†…éƒ¨é€šä¿¡ï¼‰

| åœºæ™¯ | æ¸ é“ | å—ä¼— | é¢‘ç‡ |
|------|------|------|------|
| P0 äº‹ä»¶å¯åŠ¨ | Slack + ç”µè¯ | å…¨æŠ€æœ¯å›¢é˜Ÿ + ç®¡ç†å±‚ | ç«‹å³ |
| P1 äº‹ä»¶å¯åŠ¨ | Slack | ç›¸å…³æŠ€æœ¯å›¢é˜Ÿ | ç«‹å³ |
| P2 äº‹ä»¶å¯åŠ¨ | Slack | å¯¹åº”æ¨¡å—è´Ÿè´£äºº | 30 åˆ†é’Ÿå†… |
| çŠ¶æ€æ›´æ–° | Slack Thread | å“åº”å›¢é˜Ÿ | æŒ‰ Severity å®šä¹‰ |
| äº‹ä»¶ç»“æŸ | Slack + é‚®ä»¶ | å…¨æŠ€æœ¯å›¢é˜Ÿ | ç»“æŸæ—¶ |
| å¤ç›˜å®Œæˆ | é‚®ä»¶ | å…¨å›¢é˜Ÿ | 48 å°æ—¶å†… |

### External Communicationï¼ˆå¤–éƒ¨é€šä¿¡ï¼‰

| åœºæ™¯ | æ¸ é“ | å†…å®¹ | è´Ÿè´£äºº |
|------|------|------|--------|
| æœåŠ¡ä¸­æ–­ | App å†…å…¬å‘Š / çŠ¶æ€é¡µ | "æˆ‘ä»¬æ­£åœ¨å¤„ç†æœåŠ¡é—®é¢˜ï¼Œé¢„è®¡ X åˆ†é’Ÿå†…æ¢å¤" | Comms Lead |
| ä¸­æ–­æŒç»­ | åŒä¸Š | æ¯ 30 åˆ†é’Ÿæ›´æ–°è¿›å±• | Comms Lead |
| æœåŠ¡æ¢å¤ | åŒä¸Š | "æœåŠ¡å·²æ¢å¤æ­£å¸¸ï¼Œæ„Ÿè°¢è€å¿ƒç­‰å¾…" | Comms Lead |
| äº‹åè¯´æ˜ | é‚®ä»¶ / åšå®¢ | ä»… P0 äº‹ä»¶éœ€è¦ï¼Œè§£é‡ŠåŸå› å’Œæ”¹è¿›æªæ–½ | Product + Comms |

### Message Templates

**äº‹ä»¶å¯åŠ¨é€šçŸ¥**ï¼š
```
ğŸš¨ [P0/P1/P2] Incident: [ç®€çŸ­æè¿°]
- å½±å“ï¼š[å—å½±å“çš„åŠŸèƒ½/ç”¨æˆ·]
- çŠ¶æ€ï¼šè°ƒæŸ¥ä¸­ / æ­¢æŸä¸­ / å·²æ¢å¤
- Commanderï¼š[å§“å]
- æ²Ÿé€šæ¸ é“ï¼š[Slack Thread / ç”µè¯]
```

**çŠ¶æ€æ›´æ–°**ï¼š
```
ğŸ“‹ Update [æ—¶é—´]
- å½“å‰çŠ¶æ€ï¼š[è¿›å±•æè¿°]
- ä¸‹ä¸€æ­¥ï¼š[è®¡åˆ’åŠ¨ä½œ]
- ETAï¼š[é¢„è®¡æ¢å¤æ—¶é—´]
```

**äº‹ä»¶ç»“æŸé€šçŸ¥**ï¼š
```
âœ… Incident Resolved: [ç®€çŸ­æè¿°]
- æŒç»­æ—¶é—´ï¼š[å¼€å§‹æ—¶é—´] - [ç»“æŸæ—¶é—´]
- æ ¹å› ï¼š[ç®€è¦è¯´æ˜]
- å¤ç›˜ï¼š[æ—¥æœŸ/æ—¶é—´]
```

---

## Rollback Decision Guide

### When to Rollbackï¼ˆä½•æ—¶å›æ»šï¼‰

**ç«‹å³å›æ»š**ï¼ˆæ— éœ€è®¨è®ºï¼‰ï¼š
- API é”™è¯¯ç‡ > 10% æŒç»­ 5 åˆ†é’Ÿ
- ç”¨æˆ·å®Œå…¨æ— æ³•ç™»å½•
- æ”¯ä»˜æˆåŠŸç‡ < 90%
- æ•°æ®åº“è¿æ¥æ± è€—å°½
- ä¸¥é‡å®‰å…¨æ¼æ´è¢«åˆ©ç”¨

**è€ƒè™‘å›æ»š**ï¼ˆéœ€ Incident Commander å†³ç­–ï¼‰ï¼š
- API é”™è¯¯ç‡ 5-10% æŒç»­ 10 åˆ†é’Ÿ
- å…³é”®åŠŸèƒ½ï¼ˆSolve æµç¨‹ï¼‰éƒ¨åˆ†å¤±è´¥
- æ€§èƒ½ä¸¥é‡åŠ£åŒ–ï¼ˆp95 > 5sï¼‰
- çƒ­ä¿®å¤ 30 åˆ†é’Ÿå†…æ— æ³•å®Œæˆ

**ä¸å›æ»š**ï¼š
- éå…³é”®åŠŸèƒ½é—®é¢˜
- ä»…å½±å“å°‘é‡ç”¨æˆ·
- æœ‰æ˜ç¡®çš„å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### Rollback Procedureï¼ˆå›æ»šæµç¨‹ï¼‰

| ç»„ä»¶ | å›æ»šæ–¹å¼ | å‘½ä»¤/æ“ä½œ | è´Ÿè´£äºº |
|------|----------|-----------|--------|
| Backend | éƒ¨ç½²ä¸Šä¸€ç‰ˆæœ¬ | å‚ç…§ `PROD_DEPLOY.md` | Backend Lead |
| Database | æ‰§è¡Œå›æ»šè„šæœ¬ | `alembic downgrade -1` | Backend Lead |
| Mobile | ç¦ç”¨ OTA æ›´æ–° | EAS Update rollback | Mobile Lead |
| Config | æ¢å¤ç¯å¢ƒå˜é‡ | ä»å¤‡ä»½æ¢å¤ | DevOps |

### Rollback Verificationï¼ˆå›æ»šéªŒè¯ï¼‰

- [ ] Health check endpoints å…¨ç»¿
- [ ] æ ¸å¿ƒ API å“åº”æ­£å¸¸
- [ ] ç”¨æˆ·å¯æ­£å¸¸ç™»å½•
- [ ] æ”¯ä»˜æµç¨‹å¯ç”¨ï¼ˆæµ‹è¯•å¡ï¼‰
- [ ] é”™è¯¯ç‡æ¢å¤æ­£å¸¸

---

## Postmortem Template

```markdown
# Postmortem: [äº‹ä»¶æ ‡é¢˜]

**Date**: YYYY-MM-DD
**Severity**: P0 / P1 / P2
**Duration**: HH:MM - HH:MM (X å°æ—¶ Y åˆ†é’Ÿ)
**Author**: [å§“å]
**Status**: Draft / Final

---

## Summary

[2-3 å¥è¯æè¿°äº‹ä»¶æ¦‚è¦]

---

## Impact

- **ç”¨æˆ·å½±å“**ï¼š[å—å½±å“çš„ç”¨æˆ·æ•°/ç™¾åˆ†æ¯”]
- **åŠŸèƒ½å½±å“**ï¼š[å“ªäº›åŠŸèƒ½å—æŸ]
- **æŒç»­æ—¶é—´**ï¼š[ä»å‘ç°åˆ°æ¢å¤çš„æ—¶é—´]
- **ä¸šåŠ¡å½±å“**ï¼š[æ”¶å…¥æŸå¤±ã€ç”¨æˆ·æµå¤±ç­‰]

---

## Timeline

| æ—¶é—´ | äº‹ä»¶ |
|------|------|
| HH:MM | äº‹ä»¶å¼€å§‹/é¦–æ¬¡å‘Šè­¦ |
| HH:MM | ç¡®è®¤é—®é¢˜ï¼ŒæŒ‡æ´¾ Incident Commander |
| HH:MM | è¯†åˆ«æ ¹å›  |
| HH:MM | å¼€å§‹æ‰§è¡Œæ­¢æŸæ–¹æ¡ˆ |
| HH:MM | æ­¢æŸå®Œæˆï¼ŒæœåŠ¡æ¢å¤ |
| HH:MM | å®£å¸ƒäº‹ä»¶ç»“æŸ |

---

## Root Cause

[è¯¦ç»†æè¿°æ ¹æœ¬åŸå› ]

---

## Resolution

[æè¿°å¦‚ä½•è§£å†³é—®é¢˜]

---

## What Went Well

- [åšå¾—å¥½çš„åœ°æ–¹ 1]
- [åšå¾—å¥½çš„åœ°æ–¹ 2]

---

## What Went Wrong

- [å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ 1]
- [å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ 2]

---

## Action Items

| # | æ”¹è¿›æªæ–½ | è´Ÿè´£äºº | æˆªæ­¢æ—¥æœŸ | çŠ¶æ€ |
|---|----------|--------|----------|------|
| 1 | [å…·ä½“æ”¹è¿›æªæ–½] | [å§“å] | YYYY-MM-DD | TODO |
| 2 | [å…·ä½“æ”¹è¿›æªæ–½] | [å§“å] | YYYY-MM-DD | TODO |

---

## Lessons Learned

[ä»è¿™æ¬¡äº‹ä»¶ä¸­å­¦åˆ°çš„å…³é”®ç»éªŒ]
```

---

## Related Documents

| Document | Path | Purpose |
|----------|------|---------|
| Launch Day Runbook | `docs/release/launch-day-runbook.md` | ä¸Šçº¿æµç¨‹ä¸å›æ»šè§¦å‘ |
| Ownership Matrix | `docs/release/ownership-matrix.md` | è´Ÿè´£äººåˆ†å·¥ |
| Risk Register | `docs/release/risk-register.md` | é£é™©ç™»è®° |
| Prod Deploy Runbook | `docs/PROD_DEPLOY.md` | éƒ¨ç½²ä¸å›æ»šå‘½ä»¤ |
| Monitoring Setup | `docker-compose.prod.yml` | Sentry DSN configured in .env.prod, UptimeRobot for /health endpoint |
