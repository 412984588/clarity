╔════════════════════════════════════════╗
║     Clarity Release Verification       ║
╚════════════════════════════════════════╝

=== [1/5] Backend Lint ===
All checks passed!
✅ Ruff passed

=== [2/5] Backend Type Check ===
Success: no issues found in 39 source files
✅ Mypy passed

=== [3/5] Backend Tests ===
============================= test session starts ==============================
platform darwin -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /Users/zhimingdeng/Library/Caches/pypoetry/virtualenvs/clarity-api-In7T3A-J-py3.14/bin/python
cachedir: .pytest_cache
rootdir: /Users/zhimingdeng/Documents/claude/clarity/clarity-api
configfile: pyproject.toml
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 103 items

tests/test_auth.py::test_register_success PASSED                         [  0%]
tests/test_auth.py::test_register_weak_password PASSED                   [  1%]
tests/test_auth.py::test_register_no_uppercase PASSED                    [  2%]
tests/test_auth.py::test_register_no_digit PASSED                        [  3%]
tests/test_auth.py::test_register_duplicate_email PASSED                 [  4%]
tests/test_auth.py::test_login_success PASSED                            [  5%]
tests/test_auth.py::test_login_invalid_email PASSED                      [  6%]
tests/test_auth.py::test_login_wrong_password PASSED                     [  7%]
tests/test_auth.py::test_refresh_token PASSED                            [  8%]
tests/test_auth.py::test_refresh_invalid_token PASSED                    [  9%]
tests/test_content_filter.py::test_ignore_previous_instructions PASSED   [ 10%]
tests/test_content_filter.py::test_sql_injection_style PASSED            [ 11%]
tests/test_content_filter.py::test_role_hijacking PASSED                 [ 12%]
tests/test_content_filter.py::test_system_prompt_leak PASSED             [ 13%]
tests/test_crisis_detector.py::TestCrisisDetector::test_detect_english_suicide_keywords PASSED [ 14%]
tests/test_crisis_detector.py::TestCrisisDetector::test_detect_english_self_harm_keywords PASSED [ 15%]
tests/test_crisis_detector.py::TestCrisisDetector::test_detect_spanish_keywords PASSED [ 16%]
tests/test_crisis_detector.py::TestCrisisDetector::test_no_crisis_normal_messages PASSED [ 17%]
tests/test_crisis_detector.py::TestCrisisDetector::test_case_insensitive PASSED [ 18%]
tests/test_crisis_detector.py::TestCrisisDetector::test_get_crisis_response_format PASSED [ 19%]
tests/test_crisis_detector.py::TestCrisisDetector::test_crisis_resources_contain_required_hotlines PASSED [ 20%]
tests/test_crisis_detector.py::TestCrisisDetector::test_matched_keyword_returned PASSED [ 21%]
tests/test_devices.py::test_list_devices PASSED                          [ 22%]
tests/test_devices.py::test_list_sessions PASSED                         [ 23%]
tests/test_devices.py::test_revoke_device_success PASSED                 [ 24%]
tests/test_devices.py::test_cannot_revoke_current_device PASSED          [ 25%]
tests/test_devices.py::test_revoke_limit_once_per_day PASSED             [ 26%]
tests/test_devices.py::test_revoke_session_success PASSED                [ 27%]
tests/test_devices.py::test_revoke_session_not_found PASSED              [ 28%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_anxious_english PASSED [ 29%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_anxious_panic PASSED [ 30%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_sad_english PASSED [ 31%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_sad_hopeless PASSED [ 32%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_calm_english PASSED [ 33%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_calm_relaxed PASSED [ 33%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_confused_english PASSED [ 34%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_confused_unsure PASSED [ 35%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_neutral_no_keywords PASSED [ 36%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_neutral_empty_text PASSED [ 37%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_neutral_whitespace PASSED [ 38%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_spanish_anxious PASSED [ 39%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_spanish_sad PASSED [ 40%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_chinese_anxious PASSED [ 41%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_chinese_sad PASSED [ 42%]
tests/test_emotion_detector.py::TestEmotionDetector::test_detect_chinese_confused PASSED [ 43%]
tests/test_emotion_detector.py::TestEmotionDetector::test_confidence_increases_with_multiple_matches PASSED [ 44%]
tests/test_emotion_detector.py::TestEmotionDetector::test_highest_confidence_wins PASSED [ 45%]
tests/test_emotion_detector.py::TestEmotionDetector::test_result_dataclass PASSED [ 46%]
tests/test_emotion_detector.py::TestEmotionDetector::test_confidence_capped_at_1 PASSED [ 47%]
tests/test_emotion_detector.py::TestEmotionDetector::test_case_insensitive PASSED [ 48%]
tests/test_health.py::test_placeholder PASSED                            [ 49%]
tests/test_llm_stream.py::test_llm_stream_emits_tokens_and_done PASSED   [ 50%]
tests/test_oauth.py::test_google_oauth_success PASSED                    [ 51%]
tests/test_oauth.py::test_google_oauth_creates_new_user PASSED           [ 52%]
tests/test_oauth.py::test_google_oauth_links_existing_user PASSED        [ 53%]
tests/test_oauth.py::test_google_oauth_invalid_token PASSED              [ 54%]
tests/test_oauth.py::test_google_oauth_email_not_verified PASSED         [ 55%]
tests/test_oauth.py::test_apple_oauth_success PASSED                     [ 56%]
tests/test_oauth.py::test_apple_oauth_invalid_token PASSED               [ 57%]
tests/test_oauth.py::test_apple_oauth_account_not_linked PASSED          [ 58%]
tests/test_oauth.py::test_google_oauth_issuer_invalid PASSED             [ 59%]
tests/test_password_reset.py::test_forgot_password_unknown_email_returns_200 PASSED [ 60%]
tests/test_password_reset.py::test_forgot_password_known_email PASSED    [ 61%]
tests/test_password_reset.py::test_reset_password_success PASSED         [ 62%]
tests/test_password_reset.py::test_reset_password_token_single_use PASSED [ 63%]
tests/test_password_reset.py::test_reset_password_expired_token PASSED   [ 64%]
tests/test_password_reset.py::test_reset_password_invalidates_sessions PASSED [ 65%]
tests/test_prompt_injection.py::test_sanitize_user_input_removes_injection_patterns PASSED [ 66%]
tests/test_prompt_injection.py::test_strip_pii_removes_email_and_phone PASSED [ 66%]
tests/test_revenuecat_webhooks.py::test_webhook_missing_auth_returns_401 PASSED [ 67%]
tests/test_revenuecat_webhooks.py::test_webhook_invalid_auth_returns_401 PASSED [ 68%]
tests/test_revenuecat_webhooks.py::test_webhook_initial_purchase PASSED  [ 69%]
tests/test_revenuecat_webhooks.py::test_webhook_renewal PASSED           [ 70%]
tests/test_revenuecat_webhooks.py::test_webhook_expiration PASSED        [ 71%]
tests/test_revenuecat_webhooks.py::test_webhook_idempotency_duplicate_event PASSED [ 72%]
tests/test_revenuecat_webhooks.py::test_webhook_concurrency_final_state_correct PASSED [ 73%]
tests/test_sessions.py::test_revoked_session_invalidates_token PASSED    [ 74%]
tests/test_sessions.py::test_sessions_unauthenticated_returns_401 PASSED [ 75%]
tests/test_sessions.py::test_create_session_returns_201 PASSED           [ 76%]
tests/test_sessions.py::test_list_sessions_returns_array PASSED          [ 77%]
tests/test_sessions.py::test_get_session_returns_correct_data PASSED     [ 78%]
tests/test_sessions.py::test_get_other_users_session_returns_404 PASSED  [ 79%]
tests/test_sessions.py::test_sse_endpoint_returns_event_stream PASSED    [ 80%]
tests/test_sessions.py::test_sse_invalid_session_returns_404 PASSED      [ 81%]
tests/test_sessions_patch.py::test_update_status_success PASSED          [ 82%]
tests/test_sessions_patch.py::test_update_step_valid_transition PASSED   [ 83%]
tests/test_sessions_patch.py::test_update_step_invalid_transition_fails PASSED [ 84%]
tests/test_sessions_patch.py::test_update_other_users_session_fails PASSED [ 85%]
tests/test_state_machine.py::test_valid_transitions PASSED               [ 86%]
tests/test_state_machine.py::test_invalid_transitions PASSED             [ 87%]
tests/test_state_machine.py::test_terminal_state PASSED                  [ 88%]
tests/test_subscriptions.py::test_subscriptions_unauthenticated_returns_401 PASSED [ 89%]
tests/test_subscriptions.py::test_get_current_subscription PASSED        [ 90%]
tests/test_subscriptions.py::test_get_usage PASSED                       [ 91%]
tests/test_subscriptions.py::test_checkout_invalid_price_id PASSED       [ 92%]
tests/test_subscriptions.py::test_portal_no_customer_returns_404 PASSED  [ 93%]
tests/test_usage_concurrency.py::test_usage_session_count_concurrent_requests PASSED [ 94%]
tests/test_webhooks.py::test_webhook_missing_signature_returns_400 PASSED [ 95%]
tests/test_webhooks.py::test_webhook_invalid_signature_returns_400 PASSED [ 96%]
tests/test_webhooks.py::test_webhook_checkout_completed PASSED           [ 97%]
tests/test_webhooks.py::test_webhook_invoice_paid PASSED                 [ 98%]
tests/test_webhooks.py::test_webhook_payment_failed PASSED               [ 99%]
tests/test_webhooks.py::test_webhook_subscription_deleted PASSED         [100%]

============================= 103 passed in 15.98s =============================
✅ Pytest passed

=== [4/5] Mobile Lint ===

> clarity-mobile@1.0.0 lint
> eslint . --ext .ts,.tsx

✅ ESLint passed

=== [5/5] Mobile Type Check ===
✅ TypeScript passed

╔════════════════════════════════════════╗
║     ✅ ALL CHECKS PASSED               ║
╚════════════════════════════════════════╝

Optional: Run these manually if server is running:
  curl http://localhost:8000/health
  curl http://localhost:8000/health/ready
  curl http://localhost:8000/health/live
